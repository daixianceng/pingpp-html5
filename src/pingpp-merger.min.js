!function(){function e(e,a,i){var r=document.createElement("form");r.setAttribute("method",a),r.setAttribute("action",e);for(var n in i)if(t.call(i,n)){var _=document.createElement("input");_.setAttribute("type","hidden"),_.setAttribute("name",n),_.setAttribute("value",i[n]),r.appendChild(_)}document.body.appendChild(r),r.submit()}function a(e,a,i){"undefined"==typeof i&&(i=!1);var t=[];for(var r in e)("bfb_wap"!=a||"url"!=r)&&("yeepay_wap"!=a||"mode"!=r)&&t.push(r+"="+(i?encodeURIComponent(e[r]):e[r]));return t.join("&")}var i="2.0.7",t={}.hasOwnProperty,r=function(){},n={PINGPP_NOTIFY_URL:"https://api.pingxx.com/notify/charges/",UPACP_WAP_URL:"https://gateway.95516.com/gateway/api/frontTransReq.do",ALIPAY_WAP_URL:"http://wappaygw.alipay.com/service/rest.htm",UPMP_WAP_URL:"uppay://uppayservice/?style=token&paydata=",JDPAY_WAP_URL:"https://m.jdpay.com/wepay/web/pay",YEEPAY_WAP_URL:"https://ok.yeepay.com/paymobile/api/pay/request",YEEPAY_WAP_TEST_URL:"http://mobiletest.yeepay.com/paymobile/api/pay/request",PINGPP_MOCK_URL:"http://sissi.pingxx.com/mock.php",ALIPAY_PC_DIRECT_URL:"https://mapi.alipay.com/gateway.do",UPACP_PC_URL:"https://gateway.95516.com/gateway/api/frontTransReq.do"},_={alipay_wap:"alipay_wap",upmp_wap:"upmp_wap",upacp_wap:"upacp_wap",bfb_wap:"bfb_wap",wx_pub:"wx_pub",yeepay_wap:"yeepay_wap",jdpay_wap:"jdpay_wap",alipay_pc_direct:"alipay_pc_direct",upacp_pc:"upacp_pc"};r.prototype={version:i,_resultCallback:void 0,_jsApiParameters:{},_debug:!1,_signature:void 0,createPayment:function(i,r,l,o){"function"==typeof r&&(this._resultCallback=r),"undefined"!=typeof l&&(this._signature=l),"boolean"==typeof o&&(this._debug=o);var p;if("string"==typeof i)try{p=JSON.parse(i)}catch(c){return void this._innerCallback("fail",this._error("json_decode_fail"))}else p=i;if("undefined"==typeof p)return void this._innerCallback("fail",this._error("json_decode_fail"));if(!t.call(p,"id"))return void this._innerCallback("fail",this._error("invalid_charge","no_charge_id"));if(!t.call(p,"channel"))return void this._innerCallback("fail",this._error("invalid_charge","no_channel"));var s=p.channel;if(!t.call(p,"credential"))return void this._innerCallback("fail",this._error("invalid_charge","no_credential"));if(!p.credential)return void this._innerCallback("fail",this._error("invalid_credential","credential_is_undefined"));if(!t.call(_,s))return void this._innerCallback("fail",this._error("invalid_charge","no_such_channel:"+s));if(!t.call(p.credential,s))return void this._innerCallback("fail",this._error("invalid_credential","no_valid_channel_credential"));if(!t.call(p,"livemode"))return void this._innerCallback("fail",this._error("invalid_charge","no_livemode"));if(0==p.livemode)return void this._testModeNotify(p);var d=p.credential[s];if(s==_.upmp_wap)location.href=n.UPMP_WAP_URL+d.paydata;else if(s==_.upacp_wap)e(n.UPACP_WAP_URL,"post",d);else if(s==_.alipay_wap)if(d._input_charset="utf-8","undefined"!=typeof _AP){var f=a(d,s,!0);_AP.pay(n.ALIPAY_WAP_URL+"?"+f)}else e(n.ALIPAY_WAP_URL,"get",d);else if(s==_.bfb_wap){if(!t.call(d,"url"))return void this._innerCallback("fail",this._error("invalid_credential","missing_field:url"));location.href=d.url+"?"+a(d,s)}else if(s==_.yeepay_wap){for(var u=["merchantaccount","encryptkey","data"],h=0;h<u.length;h++)if(!t.call(d,u[h]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+u[h]));t.call(d,"mode")&&"test"==d.mode?location.href=n.YEEPAY_WAP_TEST_URL+"?"+a(d,s,!0):location.href=n.YEEPAY_WAP_URL+"?"+a(d,s,!0)}else if(s==_.wx_pub){for(var u=["appId","timeStamp","nonceStr","package","signType","paySign"],h=0;h<u.length;h++)if(!t.call(d,u[h]))return void this._innerCallback("fail",this._error("invalid_credential","missing_field_"+u[h]));this._jsApiParameters=d,this._callpay()}else if(s==_.jdpay_wap)e(n.JDPAY_WAP_URL,"post",d);else if(s==_.upacp_pc)e(n.UPACP_PC_URL,"post",d);else if(s==_.alipay_pc_direct){t.call(d,"_input_charset")||(d._input_charset="utf-8");var f=a(d,s,!0);"undefined"!=typeof _AP?_AP.pay(n.ALIPAY_PC_DIRECT_URL+"?"+f):location.href=n.ALIPAY_PC_DIRECT_URL+"?"+f}},_jsApiCall:function(){var e=this;e._jsApiParameters!={}&&WeixinJSBridge.invoke("getBrandWCPayRequest",e._jsApiParameters,function(a){"get_brand_wcpay_request:ok"==a.err_msg?e._innerCallback("success"):"get_brand_wcpay_request:cancel"==a.err_msg?e._innerCallback("cancel"):e._innerCallback("fail",e._error("wx_result_fail",a.err_msg))})},_callpay:function(){function e(){a._jsApiCall()}var a=this;if("undefined"!=typeof wx&&"undefined"!=typeof a._signature){var i=!1;wx.config({debug:a._debug,appId:a._jsApiParameters.appId,timestamp:a._jsApiParameters.timeStamp,nonceStr:a._jsApiParameters.nonceStr,signature:a._signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){i||wx.chooseWXPay({timestamp:a._jsApiParameters.timeStamp,nonceStr:a._jsApiParameters.nonceStr,"package":a._jsApiParameters["package"],signType:a._jsApiParameters.signType,paySign:a._jsApiParameters.paySign,success:function(e){"chooseWXPay:ok"==e.errMsg?a._innerCallback("success"):a._innerCallback("fail",a._error("wx_result_fail",e.errMsg))},cancel:function(e){a._innerCallback("cancel")},fail:function(e){a._innerCallback("fail",a._error("wx_result_fail",e.errMsg))}})}),wx.error(function(e){i=!0,a._innerCallback("fail",a._error("wx_config_error",e.errMsg))})}else"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e),document.attachEvent("onWeixinJSBridgeReady",e)):this._jsApiCall()},_error:function(e,a){return e="undefined"==typeof e?"":e,a="undefined"==typeof a?"":a,{msg:e,extra:a}},_innerCallback:function(e,a){"function"==typeof this._resultCallback&&("undefined"==typeof a&&(a=this._error()),this._resultCallback(e,a))},_testModeNotify:function(e){var i=this;if(e.channel==_.wx_pub){var r=confirm("模拟付款？");if(r){var l=new XMLHttpRequest;l.open("GET",n.PINGPP_NOTIFY_URL+e.id+"?livemode=false",!0),l.onload=function(){if(l.status>=200&&l.status<400&&"success"==l.responseText)i._innerCallback("success");else{var e="http_code:"+l.status+";response:"+l.responseText;i._innerCallback("fail",i._error("testmode_notify_fail",e))}},l.onerror=function(){i._innerCallback("fail",i._error("network_err"))},l.send()}else i._innerCallback("cancel")}else{var o={ch_id:e.id,scheme:"http",channel:e.channel};t.call(e,"order_no")?o.order_no=e.order_no:t.call(e,"orderNo")&&(o.order_no=e.orderNo),t.call(e,"time_expire")?o.time_expire=e.time_expire:t.call(e,"timeExpire")&&(o.time_expire=e.timeExpire),t.call(e,"extra")&&(o.extra=encodeURIComponent(JSON.stringify(e.extra))),location.href=n.PINGPP_MOCK_URL+"?"+a(o)}}},r.prototype.payment=r.prototype.createPayment,window.pingpp=new r,window.PINGPP_PAY_SDK=window.PINGPP_WX_PUB=window.pingppPc=window.pingpp}();